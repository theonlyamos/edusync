# InsyteAI Embed Architecture - Visual Flow

## ğŸ—ï¸ Complete System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           YOUR INSYTEAI PLATFORM                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                      REGULAR USERS (Cookie Auth)                      â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  Login â†’ /learn â†’ Start Session                                       â”‚  â”‚
â”‚  â”‚     â†“                                                                  â”‚  â”‚
â”‚  â”‚  POST /api/learning/sessions                                          â”‚  â”‚
â”‚  â”‚     â†“                                                                  â”‚  â”‚
â”‚  â”‚  Voice Chat + Visualizations                                          â”‚  â”‚
â”‚  â”‚     â†“                                                                  â”‚  â”‚
â”‚  â”‚  POST /api/genai/visualize  [Session Cookie Auth]                    â”‚  â”‚
â”‚  â”‚     â†“                                                                  â”‚  â”‚
â”‚  â”‚  Credits deducted from user account                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    DEVELOPERS (API Key Management)                    â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  Login â†’ /session/api-keys                                            â”‚  â”‚
â”‚  â”‚     â†“                                                                  â”‚  â”‚
â”‚  â”‚  POST /api/embed/keys                                                 â”‚  â”‚
â”‚  â”‚     { name: "My Website", allowed_domains: ["example.com"] }         â”‚  â”‚
â”‚  â”‚     â†“                                                                  â”‚  â”‚
â”‚  â”‚  Returns: { api_key: "isk_abc123..." } â† COPY THIS                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                     â†“ Embed on their website

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DEVELOPER'S WEBSITE (example.com)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  <iframe src="insyteai.com/session/embed/new?apiKey=isk_abc123...">        â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      EMBEDDED INSYTEAI SESSION                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚                                                               â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  [Start AI Session] â† End user clicks                       â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                               â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â†“ POST /api/embed/sessions                                 â”‚  â”‚    â”‚
â”‚  â”‚  â”‚    Headers: { Authorization: "Bearer isk_abc123..." }       â”‚  â”‚    â”‚
â”‚  â”‚  â”‚    â†“                                                          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚    âœ… Validates API key                                      â”‚  â”‚    â”‚
â”‚  â”‚  â”‚    âœ… Checks developer has credits                           â”‚  â”‚    â”‚
â”‚  â”‚  â”‚    âœ… Creates session with api_key_id                        â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                               â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  Student: "Explain photosynthesis"                          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â†“                                                            â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                               â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â†“ POST /api/genai/visualize                                â”‚  â”‚    â”‚
â”‚  â”‚  â”‚    Headers: { Authorization: "Bearer isk_abc123..." }       â”‚  â”‚    â”‚
â”‚  â”‚  â”‚    â†“                                                          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚    âœ… Validates API key                                      â”‚  â”‚    â”‚
â”‚  â”‚  â”‚    âœ… Generates visualization                                â”‚  â”‚    â”‚
â”‚  â”‚  â”‚    âœ… Returns code + explanation                             â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                               â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  [Beautiful visualization appears]                          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                               â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â±ï¸  Every 60 seconds:                                       â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â†“ POST /api/embed/credits/deduct-minute                    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚    { sessionId: "uuid" }                                     â”‚  â”‚    â”‚
â”‚  â”‚  â”‚    Headers: { Authorization: "Bearer isk_abc123..." }       â”‚  â”‚    â”‚
â”‚  â”‚  â”‚    â†“                                                          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚    âœ… Validates API key                                      â”‚  â”‚    â”‚
â”‚  â”‚  â”‚    âœ… Verifies session ownership                             â”‚  â”‚    â”‚
â”‚  â”‚  â”‚    ğŸ’° Deduct 1 credit from DEVELOPER's account              â”‚  â”‚    â”‚
â”‚  â”‚  â”‚    â†“                                                          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚    Returns: { remainingCredits: 94 }                        â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                               â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  If credits reach 0:                                         â”‚  â”‚    â”‚
â”‚  â”‚  â”‚    âŒ Session automatically stops                            â”‚  â”‚    â”‚
â”‚  â”‚  â”‚    âš ï¸  "Out of credits" message shown                        â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                               â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                               â”‚
â”‚  ğŸ’³ Credits charged to: Developer (not the end user!)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Authentication Decision Tree

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Request to API Endpoint     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Check for Cookie â”‚
    â”‚ (Session Auth)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
       â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”
      Yes      No
       â”‚        â”‚
       â†“        â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ User  â”‚  â”‚ Check Authorization â”‚
   â”‚ Found â”‚  â”‚ Header or Query     â”‚
   â””â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚               â”‚
       â”‚           â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”
       â”‚          Yes      No
       â”‚           â”‚        â”‚
       â”‚           â†“        â†“
       â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚      â”‚ API Key â”‚ â”‚ Return   â”‚
       â”‚      â”‚ Valid?  â”‚ â”‚ 401      â”‚
       â”‚      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚           â”‚
       â”‚       â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”
       â”‚      Yes      No
       â”‚       â”‚        â”‚
       â”‚       â”‚        â†“
       â”‚       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚       â”‚   â”‚ Return   â”‚
       â”‚       â”‚   â”‚ 401      â”‚
       â”‚       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚       â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                      â”‚
                      â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  AUTHORIZED   â”‚
              â”‚  Proceed with â”‚
              â”‚  Request      â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ Database Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     auth.users      â”‚
â”‚  (Supabase Auth)    â”‚
â”‚                     â”‚
â”‚  - id (uuid)        â”‚
â”‚  - email            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ user_id (FK)
           â”‚
     â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                        â”‚
     â†“                                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   user_credits     â”‚              â”‚   embed_api_keys     â”‚
â”‚                    â”‚              â”‚                      â”‚
â”‚  - user_id (FK)    â”‚              â”‚  - id (uuid)         â”‚
â”‚  - credits (int)   â”‚              â”‚  - user_id (FK)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  - api_key (text)    â”‚
                                     â”‚  - allowed_domains   â”‚
                                     â”‚  - is_active (bool)  â”‚
                                     â”‚  - total_minutes     â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                â”‚
                                                â”‚ api_key_id (FK)
                                                â”‚
                                                â†“
                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                     â”‚  learning_sessions   â”‚
                                     â”‚                      â”‚
                                     â”‚  - id (uuid)         â”‚
                                     â”‚  - user_id (FK)      â”‚
                                     â”‚  - api_key_id (FK)   â”‚â—„â”€â”
                                     â”‚  - is_embedded       â”‚  â”‚
                                     â”‚  - status            â”‚  â”‚
                                     â”‚  - topic             â”‚  â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                                â”‚               â”‚
                                                â”‚ session_id    â”‚
                                                â”‚               â”‚
                                                â†“               â”‚
                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                                     â”‚ learning_           â”‚  â”‚
                                     â”‚ visualizations      â”‚  â”‚
                                     â”‚                     â”‚  â”‚
                                     â”‚  - id (uuid)        â”‚  â”‚
                                     â”‚  - session_id (FK)  â”œâ”€â”€â”˜
                                     â”‚  - library          â”‚
                                     â”‚  - code             â”‚
                                     â”‚  - explanation      â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Credit Deduction Flow:
1. API key validated â†’ userId extracted
2. Check user_credits.credits WHERE user_id = userId
3. If sufficient: credits = credits - 1
4. Update embed_api_keys.total_minutes_used += 1
```

---

## ğŸ”„ Credit Deduction Timeline

```
Time: 0:00     Session starts
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ User presses     â”‚
              â”‚ "Start Session"  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Check: â‰¥1 credit?â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                   â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”
                  Yes      No
                   â”‚        â”‚
                   â”‚        â†“
                   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚   â”‚ Show error   â”‚
                   â”‚   â”‚ Can't start  â”‚
                   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â†“
Time: 0:00  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Session ACTIVE   â”‚
            â”‚ Credits: 100     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
Time: 1:00  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Deduct 1 credit  â”‚
            â”‚ Credits: 99      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
Time: 2:00  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Deduct 1 credit  â”‚
            â”‚ Credits: 98      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
            â”‚
            â”‚  ... continues ...
            â”‚
            â†“
Time: 99:00 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Deduct 1 credit  â”‚
            â”‚ Credits: 1       â”‚
            â”‚ âš ï¸  LOW WARNING  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
Time: 100:00 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚ Try deduct...    â”‚
             â”‚ Credits: 0       â”‚
             â”‚ âŒ INSUFFICIENT  â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â†“
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚ AUTO-STOP        â”‚
             â”‚ Session ended    â”‚
             â”‚ Show message     â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ Iframe Embedding Options

### Option 1: Direct Embed (Quickest)
```html
<!-- Developer's website -->
<iframe 
  src="https://insyteai.com/session/embed/new?apiKey=isk_abc123&topic=Biology"
  width="100%" 
  height="600px"
  frameborder="0"
  allow="microphone"
></iframe>
```

### Option 2: Create Session First (More Control)
```javascript
// Step 1: Create session via API
const response = await fetch('https://insyteai.com/api/embed/sessions', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer isk_abc123...',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    topic: 'Photosynthesis',
    metadata: { studentId: '12345' }
  })
});

const { sessionId } = await response.json();

// Step 2: Embed the session
const iframe = document.createElement('iframe');
iframe.src = `https://insyteai.com/session/embed/${sessionId}?apiKey=isk_abc123`;
iframe.width = '100%';
iframe.height = '600px';
iframe.allow = 'microphone';
document.getElementById('container').appendChild(iframe);
```

---

## ğŸ”’ Security Layers Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Security Layer 1                      â”‚
â”‚                 API Key Validation                       â”‚
â”‚  âœ“ Format check (starts with "isk_")                   â”‚
â”‚  âœ“ Exists in database                                   â”‚
â”‚  âœ“ Is active                                            â”‚
â”‚  âœ“ Not expired                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Security Layer 2                      â”‚
â”‚                 Domain Whitelisting                      â”‚
â”‚  âœ“ Extract origin from request                         â”‚
â”‚  âœ“ Check against allowed_domains                       â”‚
â”‚  âœ“ Support wildcards (*.example.com)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Security Layer 3                      â”‚
â”‚                 Rate Limiting                            â”‚
â”‚  âœ“ Check requests per hour                             â”‚
â”‚  âœ“ Check requests per day                              â”‚
â”‚  âœ“ Block if exceeded                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Security Layer 4                      â”‚
â”‚                 Resource Ownership                       â”‚
â”‚  âœ“ Verify session belongs to API key owner            â”‚
â”‚  âœ“ Check user_id matches                               â”‚
â”‚  âœ“ Prevent cross-user access                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“
                 âœ… AUTHORIZED
```

---

## ğŸ“ˆ Scaling Considerations

### Current Design Supports:

âœ… **Multiple developers** - Each with their own API keys  
âœ… **Multiple websites** - Per-key domain whitelisting  
âœ… **High concurrency** - Stateless API key validation  
âœ… **Usage tracking** - Per-key metrics and billing  
âœ… **Security** - Layered validation approach  

### Future Enhancements:

ğŸ”® **Webhook notifications** - Alert developers of low credits  
ğŸ”® **Usage analytics** - Detailed dashboards per API key  
ğŸ”® **Auto-recharge** - Automatically purchase credits  
ğŸ”® **Team management** - Multiple users per API key  
ğŸ”® **Custom branding** - White-label embeds  

---

## âœ… Quick Reference

### For Developers Embedding InsyteAI:

1. **Get API Key:** Login â†’ `/session/api-keys` â†’ Create Key
2. **Embed:** Add iframe to your website
3. **Monitor:** Check dashboard for usage
4. **Buy Credits:** When running low

### For You (InsyteAI Platform):

1. **Authentication:** âœ… Session auth + API key auth on all endpoints
2. **Billing:** âœ… Credits auto-deducted from API key owner
3. **Security:** âœ… Multi-layer validation
4. **Monitoring:** âœ… Track usage per key
5. **Developer UX:** âœ… Dashboard + docs provided

**Everything is ready to go!** ğŸš€

